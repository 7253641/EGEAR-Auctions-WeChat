/*!
* wechat-mudu.js v2.0.4
* (c) 2017 mudu.tv
* 杭州雅顾科技有限公司 版权所有
*/
(function(t,e){typeof exports==="object"&&typeof module!=="undefined"?module.exports=e():typeof define==="function"&&define.amd?define(e):t.Mudu=e()})(this,function(){"use strict";function t(){this.events={};this.subid=1}t.prototype.On=function(t,e){var n=this.subid++;var i={callback:e,subid:n};if(Array.isArray(this.events[t])){this.events[t].push(i)}else{this.events[t]=[i]}return n};t.prototype.OnMultiOnce=function(t,e){var n=this;var i=0;if(t instanceof Array){var a=t.length;t.map(function(t){var r=n.On(t,function(){i++;n.Remove(t,r);if(i===a){typeof e==="function"&&e()}})})}};t.prototype.Fire=function(t,e){if(Array.isArray(this.events[t])){this.events[t].map(function(t){t.callback(e)})}};t.prototype.Pub=function(t,e){return this.Fire.call(this,t,e)};t.prototype.Remove=function(t,e){var n;if(Array.isArray(this.events[t])){this.events[t].map(function(t,i){if(t.subid===e||t.callback===e){n=i}});typeof n==="number"&&this.events[t].splice(n,1)}};function e(t,e){var n=e-t;var i=Math.random();return t+Math.round(i*n)}function n(t){this.timerCb=t.timerCb||i;this.timer=null;this.timeGap=t.timeGap||60*1e3;this.dotTime=(new Date).getTime()}n.prototype.start=function(){var t=this;this.stop();this.timer=setTimeout(function n(){var i=t.getTime();var a=e(10,60);if(i>0){t.timerCb({duration:i})}t.timer=setTimeout(n,t.timeGap||a*1e3)},t.timeGap||e(10,60)*1e3)};n.prototype.stop=function(){if(!this.timer){this.getTime();return}clearTimeout(this.timer);this.timer=null;var t=this.getTime();if(t>0){this.timerCb({duration:t})}};n.prototype.getTime=function(){var t=(new Date).getTime();var e=t-this.dotTime;this.dotTime=t;return e};function i(){}var a="https://mudu.tv";var r="https://mudu.tv";var o="https://mudu.tv";var s="wss://msg-ws.myun.tv";var p="live";var c=(new Date).getTime()+""+e(10,99)+"weapp";var u=false;var f="";var d="openid";var h=o+"/?c=activity&a=transfer";var l=o+"/?c=activity&a=XCXGetBaseInfo";var v={};function m(){return v}function g(t){v=Object.assign(v,t)}var _=function(t){return new y(t)};function y(t){t=t||{};var e=t.ajax,n=t.cookie,i=t.scb;var a,o,s,p,c,u,f,d=false,h=[],l=false,v=[],m=0;var g=r+"/analytics/api/update_visitor_properties",_=r+"/analytics/api/on_page_view",y=r+"/analytics/api/online",O=r+"/analytics/api/on_page_exit",b=r+"/analytics/api/on_page_event";return{keepOnlineTimeGap:20*1e3,init:function(t,e,n,i,a){this.setProjectId(t);this.setVisitorId(e);this.setPage(n);f=i;this.startSession(a)},setProjectId:function(t){a=+t},getProjectId:function(){return a},setPage:function(t){var e="/activity/";if(t.indexOf(e)===0){s=t}else{s=e+t;console&&console.warn&&console.warn('data tracker needs page param as "/activity/${actHashId}"')}},getPage:function(){return s},setVisitorId:function(t){o=""+t},getVisitorId:function(){return o},startSession:function(t){var e=this;t=!t?{}:t;w({project_id:e.getProjectId(),visitor_id:e.getVisitorId(),actHashId:f,properties:t,page:e.getPage(),complete:function(){e.onPageView();e.updateProperties(t)}});e.keepOnlineTimer()},updateProperties:function(t){var e=this;t=!t?{}:t;k({properties:t,project_id:e.getProjectId(),visitor_id:e.getVisitorId()})},onPageView:function(){var t=this;j({project_id:t.getProjectId(),page:t.getPage()},function(){u=true;"function"===typeof i&&i();t.sendCookiePhone()})},sendCookiePhone:function(){var t=f;var e="phone_tracker_"+t;var n=N(e);if(!n){return}this.triggerEvent({category:"interact",action:"phone",label:""+n},function(){R(e)})},keepOnlineTimer:function(){var t=this;if(p){return}p=setInterval(function(){!c&&t.keepOnline()},t.keepOnlineTimeGap)},keepOnline:function(t){var e=this;var n={project_id:+e.getProjectId(),page:""+e.getPage()};!c&&P(n,!t)},triggerOnLeaveEvent:function(){if(d){return}for(var t=0;t<h.length;t++){if("function"===typeof h[t]){h[t]()}}d=true},onLeave:function(t){if("function"===typeof t){h.push(t)}else if(t instanceof Array){for(var e=0;e<t.length;e++){if("function"===typeof t[e]){h.push(t[e])}}}},onLeaveCancel:function(t){h=h.filter(function(e){return e!==t})},leavePage:function(){if(c){return}var t=this;var e={project_id:+t.getProjectId(),page:""+t.getPage(),page_view_id:m};S(e);c=true},triggerEvent:function(t,e){var n="function"===typeof e?e:e&&"function"===typeof e.success?e.success:undefined;var i=e&&"undefined"!==typeof e.async?e.async:true;if(!u||c){return}var a=this;var r=typeof t.project_id==="undefined"?a.getProjectId():t.project_id;var o=typeof t.page==="undefined"?a.getPage():t.page;var s=typeof t.value==="undefined"?1:t.value;I({project_id:r,page:o,category:t.category,action:t.action,label:t.label||"",value:s},{async:i,success:n})},destroy:function(){if(p){clearInterval(p)}var t=this;t.triggerOnLeaveEvent();t.keepOnline();t.leavePage()}};function w(t){var e=x();var n=e.referVisitorId||"";var i="";var a=C();var o=""+t.project_id+"_"+t.visitor_id+"_"+t.actHashId+"_"+n;var s=N(o)?"":""+n;var p={windowWidth:0,windowHeight:0,language:"zh"};try{p=wx.getSystemInfoSync()}catch(t){}A(r+"/analytics/api/create_session",{method:"POST",data:{project_id:+t.project_id,visitor_id:""+t.visitor_id,referer:i,screen_resolution:(p.windowWidth||0)+"x"+(p.windowHeight||0),language:p.language.toLowerCase().substr(0,2),from_label:a,from_value:s,properties:t.properties,page:t.page},complete:function(){if("undefined"!==typeof n){E(o,1)}if("function"===typeof t.complete){t.complete()}}})}function k(t){A(g,{method:"POST",data:t})}function j(t,e){var n="";try{var i=getCurrentPages();if(i&&i.length){n=i[i.length-1].route}}catch(t){}A(_,{method:"POST",data:{project_id:+t.project_id,location:n,title:"",page:""+t.page},async:e&&"undefined"!==e.async?e.async:true,success:function(t){try{var n=JSON.parse(t);if(n.errcode===1e3){m=n.page_view_id}}catch(t){}typeof e==="function"&&e(t);e&&"function"===typeof e.success&&e.success(t)}})}function T(t){v.push(t);if(l){return}l=true;j({project_id:a,page:s},{async:false,success:function(){for(var t=0;t<v.length;t++){var e=v[t];"function"===typeof e&&e()}v=[];l=false}})}function P(t,e){A(y,{method:"POST",data:{project_id:t.project_id,page:t.page,page_view_id:m},async:e,success:function(n){try{n=JSON.parse(n)}catch(t){n=n||""}if(n.errcode===1634){T(function(){P(t,e)})}}})}function S(t){A(O,{method:"POST",data:t,async:false})}function I(t,e){A(b,{method:"POST",data:{project_id:+t.project_id,page:""+t.page,category:""+t.category,action:""+t.action,label:""+t.label,value:+t.value,page_view_id:m},success:function(n){try{n=JSON.parse(n)}catch(t){n=n||""}if(n.errcode===1634){T(function(){I(t,e)});return}"function"===typeof e.success&&e.success()},async:e.async})}function C(){return"wechatMiniPro"}function x(){try{var t={};var e=window.location.search.replace(/^\?/,"").split("&").filter(function(t){if(t!==""&&t.indexOf("=")){return true}});e.forEach(function(e){var n=e.indexOf("=");var i=e.substring(0,n);var a=e.substring(n+1);t[i]=a});return t}catch(t){return{}}}function N(t){return M(t)}function E(t,e){var n=new Date;var i=n.getTime();var a=new Date(n.toLocaleDateString()).getTime()-1;var r=i-a;var o=24*60*60*1e3-r;J(t,e,parseInt(o/1e3))}function J(t,e,i){i=i||30*24*60*60;n.setValue(t,e,30*24*60*60)}function M(t){return n.get(t).value}function R(t){n.del(t)}function A(t,n){var i=typeof n.success==="function"?n.success:G;var a=typeof n.fail==="function"?n.fail:G;var r=typeof n.complete==="function"?n.complete:G;return e.post({url:t,data:n.data,contentType:"application/json"}).then(function(t){i(t.data);return t.data},function(t){a(t);return t}).then(r)}function G(){}}function O(t){var e=this;this.app=t.app;this.app._eventEmitter.On("rop-stream-event",function(t){var n=JSON.parse(t).stream;e.app.data.stream===n&&e.app.MsgBus.Pub("Room.StreamEvent",t)});this.Tracker=_({ajax:e.app.wajax,cookie:e.app.wajax.cookie,scb:function(){e.app._eventEmitter.Pub("tracker-init-over")}});this._initData();this.app._eventEmitter.On("room-destroy",function(){e._refreshViewNumTimer&&e._refreshViewNumTimer.stop();e._onlineTimer&&e._onlineTimer.stop();e.Tracker.destroy()})}var b=O.prototype;b._initData=function(){var t=this;var e=t.app.options.mudu_baseinfo_url+"&id="+this.app.roomId;t._startSession().then(function(){return t._fetchUserInfo(t.app.roomId).then(function(e){if(e.statusCode==403){return t._loginByAnonymous().then(function(){return t._fetchUserInfo(t.app.roomId)})}})}).then(function(){console.log("room info");return t.app.wajax.get({url:e})}).then(function(e){if(e.statusCode!=200){throw new Error("init失败")}t._enterWatchPage(t.app.roomId);var n=JSON.parse(e.data);t.app.roomHashId=n.actHashId;t.app.data.name=n.act.name;t.app.data.stream=n.act.stream;t.app.data.fee_status=n.act.fee_status;t.app.data.live_status=n.act.live_status;t.app.data.act_close_status=n.act.status;t.app.data.share_url=n.shareUrl;t.app.data.view_num=n.viewNum;t.app.data.rtmp_play_addr=n.rtmp_play_addr;t.app.data.hls_play_addr=n.hls_play_addr;t.app.data.trailer=n.trailer||{m3u8:"",open:"0",trailer_img:""};t.app.data.live_img=n.live_img||n.console_setting_image||"https://static.mudu.tv/assets/livecoverimg.jpg";t.app.data.comment={tabVisible:typeof n.menus==="object"&&n.menus[0]&&!!(n.menus.filter(function(t){return t.menu_cate===1})[0]||{}).discuss_switch};t.app.data.ppt_config={};t.app._eventEmitter.Pub("ppt-init-start",n);t.app._eventEmitter.Pub("comment-init-start",n);t.app.data.vote=n.vote;t.app.data.vote_id=n.vote?n.vote.id:"";t.app._initOver=true;t.app._eventEmitter.Pub("room-init-over",n);t._intervalRefreshNum();return n}).then(function(e){var n=m();t.app.Room.Tracker.init(e.projectId,n.id,e.actHashId,e.actHashId,{name:n.nick,third_id:n.assign_id})}).catch(function(e){t.app.MsgBus.Pub("Room.Init.Error",e)})};b._startSession=function(){var t=this;return this.app.wajax.get({url:a+"/user/api/start_session"}).then(function(){t._intervalOnline()})};b._fetchUserInfo=function(t){var e=a+"/user/api/user_info/"+t;return this.app.wajax.get({url:e,contentType:"application/json",dataType:"json"}).then(function(t){console.log("user info : ",t);if(t.statusCode==200){var e=t.data.user;e.name=e.nick;g(e)}return t})};b._loginByAnonymous=function(){var t=a+"/user/api/login_by_anonymous";return this.app.wajax.post({url:t,data:{nick:"",avatar:""},contentType:"application/json",dataType:"json"})};b._enterWatchPage=function(t){var e=a+"/user/api/enter_activity/"+t;return this.app.wajax.get({url:e,contentType:"application/json",dataType:"json"})};b._intervalRefreshNum=function(){var t=this;var e=function(e){if(e.duration<40*1e3){return}t.app._initOver&&t.RefreshViewNum(function(e){var n=JSON.parse(e);if(n.status==="y"){t.app.MsgBus.Pub("Room.ViewNumChanged",n.num)}})};e({duration:60*1e3});this._refreshViewNumTimer=new n({timerCb:e});this._refreshViewNumTimer.start()};b._intervalOnline=function(){var t=this;var e=function(e){if(e.duration<20*1e3){return}t.app._initOver&&t._online()};this._onlineTimer=new n({timerCb:e,timeGap:20*1e3});this._onlineTimer.start()};b._online=function(){var t=this;this.app.wajax.post({url:a+"/user/api/keep_alive",data:{current_page:"ACTIVITY."+t.app.roomId},contentType:"application/json",dataType:"json"}).then(function(){})};b.RefreshViewNum=function(t){if(!this.app._initOver){return}var e=o+"/?c=activity&a=Analysis&id="+this.app.data.roomId;this.app.wajax.post({url:e}).then(function(e){t(e.data)})};b.GetViewNum=function(){if(!this.app._initOver){return}return this.app.data.view_num};b.GetName=function(){if(!this.app._initOver){return}return this.app.data.name};b.GetStream=function(){if(!this.app._initOver){return}return this.app.data.stream};b.GetPlayAddr=function(){if(!this.app._initOver){return}return this.app.data.hls_play_addr};b.GetLiveImage=function(){if(!this.app._initOver){return}return this.app.data.live_img};b.GetId=function(){if(!this.app._initOver){return}return this.app.data.roomId};b.GetLiveStatus=function(){if(!this.app._initOver){return}return this.app.data.live_status};b.GetStatus=function(){if(!this.app._initOver){return}return this.app.data.act_close_status};var w={1e3:[100,"发送成功"],4915:[103,"聊天消息长度错误"],4920:[101,"管理员关闭聊天功能"],4921:[104,"不允许匿名聊天"],4923:[102,"该用户被禁言"]};function k(t){var e=this;this.app=t.app;this.app._eventEmitter.On("comment-init-start",function(){e.initCmt()});this.app._eventEmitter.On("rop-comment-new",function(t){e.app._initOver&&e.app.MsgBus.Pub("Comment.New",JSON.stringify(e.resolveCmt(JSON.parse(t))))});this.app._eventEmitter.On("rop-comment-config",function(t){if(!e.app._initOver){return}var n=JSON.parse(t);var i=e.app.data.comment.allowPublish;var a=e.app.data.comment.countVisible;e.app.data.comment.allowPublish=n.public;e.app.data.comment.countVisible=n.mobile_show_total;e.app.data.comment.tabVisible=n.show;e.app.data.comment.allowAnonymous=n.allow_anonymous;e.app.data.comment.needsCheck=n.comment_review;i!==n.public&&e.app.MsgBus.Pub("Comment.Avaliable.Changed",JSON.stringify({open:n.public?1:0}));a!==n.mobile_show_total&&e.app.MsgBus.Pub("Comment.CountVisible",JSON.stringify({open:n.mobile_show_total?1:0}))});this.app._eventEmitter.On("rop-comment-set-top",function(t){e.app._initOver&&e.app.MsgBus.Pub("Comment.Top",JSON.stringify(e.resolveCmt(JSON.parse(t))))});this.app._eventEmitter.On("rop-act-visitor-mute",function(t){t=JSON.parse(t);var n=m();t.isSelf=n.hash_id===t.visitorId;e.app._initOver&&e.app.MsgBus.Pub("Visitor.Mute",JSON.stringify(t))})}var j=k.prototype;j.initCmt=function(){var t=this;var e=this.app.roomHashId;var n=0;var i=2;this.app.wajax.get({url:a+"/comments/api/activities/"+e+"/config"}).then(function(e){if(e.statusCode===200){var a=JSON.parse(e.data);if(a.errcode===1e3){a=a.data;t.app.data.comment.allowPublish=a.public;t.app.data.comment.countVisible=a.mobile_show_total;t.app.data.comment.tabVisible=a.show;t.app.data.comment.allowAnonymous=a.allow_anonymous;t.app.data.comment.needsCheck=a.comment_review}}++n>=i&&t.app._eventEmitter.Pub("comment-init-over")});this.app.wajax.get({url:a+"/comments/api/activities/"+e+"/comments/count?reviewed=1"}).then(function(e){if(e.statusCode===200){var a=JSON.parse(e.data);if(a.errcode===1e3){t._setPage(a.total)}}++n>=i&&t.app._eventEmitter.Pub("comment-init-over")})};j._setPage=function(t){this.app.data.comment.count=t;this.count=t;this.page=Math.ceil(this.count/20)};j.Send=function(t,e){if(!this.app._initOver){return}var n=this;var i=this.app.roomHashId;var a=r+"/comments/api/activities/"+i+"/comment";var o={message:t};var s=function(i){var a=i.data;var r={};r.status=a.errcode===1e3?"y":"n";var o=w[a.errcode]||[103,"发送失败!"];r.flag=o[0];r.info=o[1];typeof e==="function"&&e(JSON.stringify(r));r.status==="y"&&n.app.Room.Tracker.triggerEvent({category:"interact",action:"comment",label:t})};this.app.wajax.post({url:a,data:o,contentType:"application/json;",dataType:"json"}).then(s)};j.Get=function(t,e){if(!this.app._initOver){return}if(t>this.page||t<=0){return}var n=this.app.roomHashId;var i=this;var a=r+"/comments/api/activities/"+n+"/comments?anchor=0&page_index="+t;var o=function(n){var a=n.data;var r={};if(a.errcode===1e3){r={status:"y",info:"评论获取成功",data:{page:t,comments:a.data.map(function(t){return i.resolveCmt(t)})}}}else{r={status:"n",info:"没有更多评论！",data:{comments:[]}}}typeof e==="function"&&e(JSON.stringify(r))};this.app.wajax.get({url:a,contentType:"application/json;",dataType:"json"}).then(o)};j.GetPage=function(){if(!this.app._initOver){return}return this.page};j.resolveCmt=function(t){try{var e=t.dateline;if("string"===typeof e){t.dateline=parseInt(new Date(e).getTime()/1e3)}}catch(t){}t.visitor_id=t.user_id;t.is_admin=t.is_admin?1:0;t.checked=t.priority!==0?1:0;t.pushed=t.is_pushed?1:0;t.top=t.priority>=100?1:0;t.avatar=t.avatar==="/assets/img/avatar.png"?"https://mudu.tv/assets/img/avatar.png":t.avatar;return t};j.GetTabVisible=function(){if(!this.app._initOver){return}return this.app.data.comment.tabVisible};j.GetInitialCount=function(){if(!this.app._initOver){return}return this.app.data.comment.count};j.GetAllowPublish=function(){if(!this.app._initOver){return}return this.app.data.comment.allowPublish};j.GetAllowAnonymous=function(){if(!this.app._initOver){return}return this.app.data.comment.allowAnonymous};j.GetNeedsCheck=function(){if(!this.app._initOver){return}return this.app.data.comment.needsCheck};j.GetCountVisible=function(){if(!this.app._initOver){return}return this.app.data.comment.countVisible};function T(t){var e=this;this.app=t.app;this.app._eventEmitter.On("rop-luckydraw-open",function(t){var n=JSON.parse(t);if(n["type"]==="open_lucky_draw"){e.app._initOver&&e.Result(function(t){e.app.MsgBus.Pub("LuckyDraw.Open",t)})}if(n["type"]=="lucky_draw_save"){e.app._initOver&&e.Get(function(t){e.app.MsgBus.Pub("LuckyDraw.Changed",t)})}})}T.prototype.Get=function(t){if(!this.app._initOver){return}var e=r+"/activity/"+this.app.roomId+"/getLuckyDrawInfo";var n={};var i=function(e){var n=e.data;var i={};i.status=n.status;i.flag=n.flag;i.info=n.msg;i.data=n.data;typeof t==="function"&&t(JSON.stringify(i))};this.app.wajax.post({url:e,data:n,contentType:"application/json;",dataType:"json"}).then(i)};T.prototype.SignUp=function(t,e){if(!this.app._initOver){return}var n=this;var i=r+"/activity/"+this.app.roomId+"/setLuckyDrawSignUp";var a={uname:t.userName,voucher:t.voucher};var o=function(i){var a=JSON.parse(i.data);var r={};r.status=a.status;r.info=a.msg;r.flag=a.flag;typeof e==="function"&&e(JSON.stringify(r));if(a.flag===100){n.app.Room.Tracker.triggerEvent({category:"interact",action:"lucky_draw"});var o=t.voucher;if(o&&/^((1)\d{10})$/.test(o)){n.app.Room.Tracker.triggerEvent({category:"interact",action:"phone",label:JSON.stringify({phone:o,is_verified:false})})}}};this.app.wajax.post({url:i,data:a}).then(o)};T.prototype.Result=function(t){if(!this.app._initOver){return}var e=o+"/?a=ajaxGetLuckyDrawResult&c=activity&id="+this.app.data.roomId;var n=function(e){var n=JSON.parse(e.data);var i={};i.status=n.status;i.flag=n.Flag;i.info=n.msg;i.data=n.data;typeof t==="function"&&t(JSON.stringify(i))};this.app.wajax.get({url:e}).then(n)};function P(t){var e=this;this.app=t.app;var n=false;var i=false;e.app._eventEmitter.On("ppt-init-start",function(){e._FetchPptInfoData.call(e,function(t){n=true;e.app.data.ppt_config.images=t.images;e.app.data.ppt_config.total_page=t.images.length;var a=t.images[t.index];e.app.data.ppt_config.url=a&&a.url?a.url:"";e.app.data.ppt_config.page=t.index+1;n&&i&&e.app._eventEmitter.Pub("ppt-init-over")});e._FetchPptConfigData.call(e,function(t){i=true;e.app.data.ppt_config.open=t.open?1:0;e.app.data.ppt_config.turnPage=t.turn?1:0;e.app.data.ppt_config.name=t.name;n&&i&&e.app._eventEmitter.Pub("ppt-init-over")})});this.app._eventEmitter.On("app.mududoc.sync",function(t){var n=JSON.parse(t);var i=n.type;switch(i){case"transcode":break;case"config":e._handleAdminChangeConfig(n);break;case"doc":e._handleAdminChangeDoc(n)}})}var S=P.prototype;S.GetUrl=function(){if(!this.app._initOver){return}if(typeof this.app.data.ppt_config==="undefined"){return""}return this.app.data.ppt_config.url||""};S.IsOpen=function(){if(!this.app._initOver){return}if(typeof this.app.data.ppt_config==="undefined"){return 0}return this.app.data.ppt_config.open||0};S.GetConfig=function(){if(!this.app._initOver){return}return this.app.data.ppt_config};S._FetchPptInfoData=function(t){var e=this;var n=this.app.roomHashId;e.app.wajax.get({url:o+"/docs/api/activities/"+n+"/documents/now?time="+(new Date).getTime()}).then(function(e){if(e.statusCode===200){var n=JSON.parse(e.data);if(n.errcode===1e3){typeof t==="function"&&t(n)}}})};S._FetchPptConfigData=function(t){var e=this;var n=this.app.roomHashId;e.app.wajax.get({url:o+"/docs/api/activities/"+n+"/config?time="+(new Date).getTime()}).then(function(e){if(e.statusCode===200){var n=JSON.parse(e.data);if(n.errcode===1e3){typeof t==="function"&&t(n)}}})};S._handleAdminChangeDoc=function(t){var e=this.app.roomHashId;var n=this;var i=t.docid;var a=t.index;var r=t.url;var s=this.app.data.ppt_config.docId;this.app.data.ppt_config.url=r;this.app.data.ppt_config.page=a+1;this.app.data.ppt_config.docId=i;if(s!==i&&i){n.app.wajax.get({url:o+"/docs/api/activities/"+e+"/documents/now?time="+(new Date).getTime()}).then(function(t){var e=JSON.parse(t.data);if(e.errcode!==1e3)return;n.app.data.ppt_config.total_page=e.images.length;n._firePPTChanged()})}else{n._firePPTChanged()}};S._handleAdminChangeConfig=function(t){var e=t.name;var n=t.open;var i=t.turn;var a=this.app.data.ppt_config.turnPage;var r=this.app.data.ppt_config.open;this.app.data.ppt_config.turnPage=i?1:0;this.app.data.ppt_config.open=n?1:0;this.app.data.ppt_config.name=e;if(r!=n){this._firePPTStatusChanged()}if(a!=i){this._firePPTTurnAvaliableChanged()}};S._firePPTChanged=function(){var t={url:this.app.data.ppt_config.url,page:this.app.data.ppt_config.page,total_page:this.app.data.ppt_config.total_page};this.app.MsgBus.Pub("PPT.Changed",JSON.stringify(t))};S._firePPTStatusChanged=function(){var t={open:this.app.data.ppt_config.open,page:this.app.data.ppt_config.page,total_page:this.app.data.ppt_config.total_page,url:this.app.data.ppt_config.url};this.app.MsgBus.Pub("PPT.Status.Changed",JSON.stringify(t))};S._firePPTTurnAvaliableChanged=function(){var t={turnPage:this.app.data.ppt_config.turnPage,page:this.app.data.ppt_config.page,total_page:this.app.data.ppt_config.total_page,url:this.app.data.ppt_config.url};this.app.MsgBus.Pub("PPT.Turn.Avaliable.Changed",JSON.stringify(t))};function I(t){var e=this;this.app=t.app;this.app._eventEmitter.On("rop-vote-changed",function(t){if(!e.app._initOver){return}var n=JSON.parse(t);e.app.data.vote_id=n.vote_id;e.app.data.vote=n;e.Get(function(t){e.app.MsgBus.Pub("Vote.Changed",t)})})}var C=I.prototype;C.Get=function(t){if(!this.app._initOver){return}var e=o+"/?c=activity&a=ajaxGetActVote";var n={vote_id:this.app.data.vote_id};if(!this.app.data.vote_id){typeof t==="function"&&t(JSON.stringify({status:"n",info:"无投票信息",flag:101}));return}var i=function(e){var n=JSON.parse(e.data);var i={};i.status=n.status;i.data=n.vote;i.data.voted=i.data.voted?1:0;i.info="获取成功";typeof t==="function"&&t(JSON.stringify(i))};this.app.wajax.post({url:e,data:n}).then(i)};C.Vote=function(t,e){if(!this.app._initOver){return}var n=this;var i=o+"/?c=activity&a=ajaxVote";var a={vote:JSON.stringify(t),act_id:this.app.roomId};var r=function(t){var i=JSON.parse(t.data);var a={};a.status=i.status;a.flag=100;a.info=i.msg;typeof e==="function"&&e(JSON.stringify(a));if(i.status==="y"){n.app.Room.Tracker.triggerEvent({category:"interact",action:"vote"})}};this.app.wajax.post({url:i,data:a}).then(r)};function x(t){var e=this;this.app=t.app;this.app._eventEmitter.On("rop-barrage-new",function(t){t=JSON.parse(t);t.text=t.message;t.stime=(new Date).getTime();t.visitor_id=t.user_id;e.app._initOver&&e.app.MsgBus.Pub("Barrage.New",JSON.stringify(t))})}function N(t){this.app=t.app}var E=N.prototype;E.Assign=function(t,e){if(!this.app._initOver){return}if(typeof t!=="object"){return}if(t.id&&!t.assignId){t.assignId=t.id}if(t.name&&t.avatar&&t.assignId){this.Register(t.name,t.avatar,t.assignId,"assign",e)}else{console.error("name、avatar、assignId are needed !!! ")}};E.Register=function(t,e,n,i,r){var o=this;if(!this.app._initOver){console.error("sdk is initing, not call this function until sdk is inited.");return}var s={};var p=a+"/user/api/login_by_other";this.app.wajax.post({url:p,data:{nick:t,avatar:e,type:i,user_id:n},contentType:"application/json",dataType:"json"}).then(function(t){var e=t.data;s.status=e.errcode===1e3?"y":"n";s.info=e.msg;s.flag=e.errcode}).then(function(){return o._fetchUserInfo(o.app.roomId)}).then(function(){var t=m();if(s.status==="y"){o.app.Room.Tracker.updateProperties({name:t.nick,third_id:t.assign_id})}o.app.MsgBus.Pub("User.Registerd",JSON.stringify(s));s.status==="y"&&typeof r==="function"&&r(t)})};E._fetchUserInfo=function(t){var e=a+"/user/api/user_info/"+t;return this.app.wajax.get({url:e,contentType:"application/json",dataType:"json"}).then(function(t){if(t.statusCode==200){var e=t.data.user;e.name=e.nick;g(e)}return t})};E._SetCookie=function(t,e,n){if(!this.app._initOver){return}g({name:t,avatar:e,id:n})};E.GetUser=function(){if(!this.app._initOver){return}return m()};function J(t){var e=this;this.statCb=function(){};this.app=t.app;this.type=p;var i=function(t){var n=parseInt(t.duration/1e3);var i=a+"/user/api/watch_time";var r={id:e.app.roomId,time:n,type:e.type,video_id:0};e.app.wajax.post({url:i,data:r,contentType:"application/json",dataType:"json"}).then(function(){e.statCb({duration:t.duration})});e.app.Room.Tracker.triggerEvent({category:"video",action:"live_watch_time",value:n})};this.timer=new n({timerCb:i});this.app._eventEmitter.On("room-destroy",function(){e.timer.stop()})}var M=J.prototype;M.OnPlay=function(){this.timer.start()};M.OnPause=function(){this.timer.stop()};M.OnEnded=function(){this.timer.stop()};M.OnPageUnload=function(){this.timer.stop()};M.OnPageHide=function(){this.timer.stop()};M.SetPlayType=function(t){this.type=t};M.SetStatCb=function(t){if(typeof t==="function"){this.statCb=t}};function R(){this.events={};this.uuid=0}var A=R.prototype;A._getListeners=function t(e){if(Object.prototype.toString.call(this.events[e])!=="[object Array]"){this.events[e]=[]}return this.events[e]};A.on=function t(e,n){if(!V(n)){throw new TypeError("listener must be a function")}var i=++this.uuid;var a={once:false,listener:n,uuid:i};if(this.events[e]){this.events[e].push(a)}else{this.events[e]=[a]}return i};A.emit=function t(e,n){var i;var a;var r=this._getListeners(e);for(i=0;i<r.length;i++){a=r[i];a.listener.apply(this,n||[]);if(a.once){this.removeListener(e,a.uuid)}}return this};A.removeListener=function(t,e){var n=this._getListeners(t);var i;n.map(function(t,n){if(t.uuid===e||t.listener===t.listener){i=n}});typeof i==="number"&&n.splice(i,1);return this};A.off=G("removeListener");function G(t){return function e(){return this[t].apply(this,arguments)}}function V(t){if(typeof t==="function"){return true}return false}function U(t,e){var n=this[e][t];if(typeof n!=="object"){n=this[e][t]={handlers:[],sid:undefined}}return n}var D="SUB";var L="UNSUB";var F=" ";var B="\r\n";var H=/^MSG\s+([^\s\r\n]+)\s+([^\s\r\n]+)\s+(([^\s\r\n]+)[^\S\r\n]+)?(\d+)\r\n/i;var q=/^\+OK\s*\r\n/i;var Q=/^-ERR\s+('.+')?\r\n/i;var K=/^PING\r\n/i;var W=/^PONG\r\n/i;var $=/^INFO\s+([^\r\n]+)\r\n/i;var X="PONG"+B;function z(t){t=t||"";return unescape(encodeURIComponent(t))}function Y(t,e,n){t=t||"";var i="";var a=0,r,o,s,p,c;c=z(t).length;n=c<n+e?c-e:n;for(r=0;r<e;a++){s=t.charCodeAt(a);r+=s<128?1:z(t[a]).length}o=a+n-1;for(p=a;a<=o;p++){s=t.charCodeAt(p);o-=s<128?1:z(t[p]).length;i+=t[p]}return i}function Z(t){var e;var n;var i;var a;var r;var o;if((n=H.exec(t))!==null||(n=H.exec(this.processMsg+t))!==null){i=n[1];e=Y(n.input,n[0].length,+n[5]);if(z(e).length!=+n[5]){this.processMsg+=t;return}if(n.input===this.processMsg+t){this.processMsg=""}this.eventEmitter.emit("socket-message",{topic:i,message:e});a=U.call(this,i,"topicMap");for(r=0;r<a.handlers.length;r++){a.handlers[r]["callback"](e)}o=n.input.substr(n[0].length+e.length+B.length);if(o!==""){Z.call(this,o)}}else if((n=q.exec(t))!==null){}else if((n=Q.exec(t))!==null){this.eventEmitter.emit("socket-message-error");this._reconnect&&this.reconnectSocket()}else if((n=W.exec(t))!==null){}else if((n=K.exec(t))!==null){this.sendMessage({data:X})}else if((n=$.exec(t))!==null){}}function tt(){if(this.socketTask){et.call(this);nt.call(this);it.call(this);at.call(this)}return this}function et(){var t=this;this.socketTask.onOpen(function(){t._socketOpen=true;t.eventEmitter.emit("socket-open");var e;var n;var i;var a="";for(i in t.topicQueueMap){e=U.call(t,i,"topicQueueMap");n=U.call(t,i,"topicMap");e.handlers.map(function(t){n.handlers.push(t)});e.handlers.splice(0,e.length);n.sid=e.sid;a+=[D,i,n.sid+B].join(F)}t.sendMessage({data:a})})}function nt(){var t=this;this.socketTask.onError(function(){t.eventEmitter.emit("socket-error");t._reconnect&&setTimeout(function(){t.reconnectSocket()},1e3);console.log("socket error")})}function it(){var t=this;this.socketTask.onClose(function(){t.eventEmitter.emit("socket-close");t._reconnect&&t.reconnectSocket()})}function at(){var t=this;this.socketTask.onMessage(function(e){t.eventEmitter.emit("socket-message",e);Z.call(t,e.data)})}function rt(){if(typeof this._opt.url==="undefined"){throw new Error("opt.url not defined, please set websocket server url");return}this._connections[this._opt.url]=this;this._debug=typeof this._opt.debug==="boolean"?this._opt.debug:false;this._reconnect=typeof this._opt.reconnect==="boolean"?this._opt.boolean:true;this.connectionOpt={url:this._opt.url};this.topicMap={};this.topicQueueMap={};this.uuid=1;this.eventEmitter=new R;this.processMsg="";typeof this._opt.success==="function"&&(this.connectionOpt.success=this._opt.success);typeof this._opt.fail==="function"&&(this.connectionOpt.fail=this._opt.fail);typeof this._opt.complete==="function"&&(this.connectionOpt.complete=this._opt.complete);this.connectSocket();tt.call(this)}var ot={};function st(t){t.prototype.subscribe=function(t,e){var n=[D,t,++this.uuid+B].join(F);var i={callback:e,submsg:n,uuid:this.uuid};var a=U.call(this,t,"topicMap");var r=U.call(this,t,"topicQueueMap");if(this._socketOpen){if(a.handlers.length==0){a.sid=this.uuid;this.sendMessage({data:n,fail:function(t){console.error(n,"订阅出错",t)}})}a.handlers.push(i)}else{if(r.handlers.length===0){r.sid=this.uuid}r.handlers.push(i)}return this.uuid}}function pt(t){t.prototype.unsubscribe=function(t){var e;var n;var i;for(e in this.topicMap){n=U.call(this,e,"topicMap");for(i=0;i<n.handlers.length;i++){if(n.handlers[i].uuid===t||n.handlers[i].callback===t){n.handlers.splice(i,1);i--}}if(n.handlers.length===0){this.sendMessage({data:[L,n.sid+B].join(F)})}}for(e in this.topicQueueMap){n=U.call(this,e,"topicQueueMap");for(i=0;i<n.handlers.length;i++){if(n.handlers[i].uuid===t||n.handlers[i].callback===t){n.handlers.splice(i,1);i--}}}}}function ct(t){t.prototype.sendMessage=function(t){!this._needClosed&&this.socketTask&&this.socketTask.send&&this.socketTask.send(t)}}function ut(t){t.prototype.connectSocket=function(){this.socketTask=wx.connectSocket(this.connectionOpt);return this}}function ft(t){t.prototype.close=function(){var t=this;t._reconnect=false;t._needClosed=true;if(!this.socketTask){t._socketOpen=false;return Promise.reject()}if(t._socketOpen){return new Promise(function(e,n){t.socketTask.close({success:function(){t._socketOpen=false;e()},fail:n})})}else{return new Promise(function(e,n){t.eventEmitter.on("socket-open",function(){t.socketTask.close({success:function(){t._socketOpen=false;e()},fail:n})})})}}}function dt(t){t.prototype.reconnectSocket=function(){this.topicQueueMap=this.topicMap;this.topicMap={};this._socketOpen=false;this.socketTask=null;this.connectSocket();tt.call(this)}}function ht(t){this._opt=t||{};this._connections=ot;this._needClosed=false;rt.call(this)}st(ht);pt(ht);ct(ht);ut(ht);ft(ht);dt(ht);var lt={resolveRop:mt,closeSocket:gt,reconnectSocket:mt};var vt=null;function mt(){var t=this;gt().catch(function(){}).then(function(){vt=new ht({url:t.ropServer||s});vt.subscribe("stream-event-"+t.app.data.stream,function(e){var n=JSON.parse(e).stream;if(t.app.data.stream===n){t._eventEmitter.Fire("rop-stream-event",e)}});vt.subscribe("mudu.comments."+t.roomHashId,function(e){try{e=JSON.parse(e);var n=e.type,i=JSON.stringify(e.data);if("comment"===n){t._eventEmitter.Fire("rop-comment-new",i)}else if("config"===n){t._eventEmitter.Fire("rop-comment-config",i)}else if("top"===n||"canceltop"===n){t._eventEmitter.Fire("rop-comment-set-top",i)}else if("danmu"===n||"highlight"===n){t._eventEmitter.Fire("rop-barrage-new",i)}}catch(t){}});vt.subscribe("mudu.activities."+t.roomHashId,function(e){try{e=JSON.parse(e);var n=e.type,i=e.data;if(n==="remban"||n==="ban"){t._eventEmitter.Fire("rop-act-visitor-mute",JSON.stringify({user:i.username,visitorId:i.user_id,mute:n==="ban"?1:2}))}}catch(t){}});vt.subscribe("lucky_draw_"+t.roomId,function(e){t._eventEmitter.Fire("rop-luckydraw-open",e)});vt.subscribe("app.mududoc.sync."+t.roomHashId,function(e){t._eventEmitter.Fire("app.mududoc.sync",e)});vt.subscribe("vote_"+t.roomId,function(e){t._eventEmitter.Fire("rop-vote-changed",e)})})}function gt(){var t=Promise.resolve();if(vt!==null){t=vt.close()}try{return t}finally{vt=null}}function _t(e){e.prototype.Init=function(e,n){var i=this;this.roomId=e;this.roomHashId="";this.MsgBus=new t;this._eventEmitter=new t;this._initOver=false;this.data={roomId:e};this.Room=new O({app:this});this.Room.Comment=new k({app:this});this.Room.LuckyDraw=new T({app:this});this.Room.PPT=new P({app:this});this.Room.Vote=new I({app:this});this.Room.Barrage=new x({app:this});this.Room.User=new N({app:this});this.Room.Player=new J({app:this});this._eventEmitter.OnMultiOnce(["room-init-over","ppt-init-over","tracker-init-over","comment-init-over"],function(){lt.resolveRop.call(i);i.Room.reconnectSocket=lt.resolveRop.bind(i);i.Room.closeSocket=lt.closeSocket.bind(i);i._initOver=true;i.MsgBus.Pub("Room.Init.Over");typeof n==="function"&&n()})}}function yt(t){t.prototype.setOption=function(t,e){this.options[t]=e}}function Ot(t){t.prototype.GetInitStatus=function(){return this._initOver}}var bt=/([^,]|,\s)+/g;var wt="WAJAX_COOKIE";var kt="html";var jt="application/x-www-form-urlencoded";var Tt="xtoken";function Pt(t){var e=Object.keys(t);return e.map(function(e){return e+"="+encodeURIComponent(t[e]["value"])}).join("; ")}function St(t){t=decodeURIComponent(t);var e=t.replace(/(\/,\s)/g,"/,").match(bt);var n;var i={};var a;for(n=0;n<e.length;n++){a=It(e[n]);i[a.name]=a}return i}function It(t){var e=t.split(";").filter(Ct);var n=e.shift().split("=");var i=n.shift();var a=n.join("=");var r;var o={name:i,value:a};for(r=0;r<e.length;r++){var s=e[r].split("=");var p=s.shift().trimLeft().toLowerCase();a=s.join("=");if(p==="expires"){o.expires=a}else if(p==="max-age"){o.maxAge=parseInt(a,10)}else if(p==="httponly"){o.httpOnly=true}else if(p==="secure"){o.secure=true}else{o[p]=a}}if(typeof o.expires==="undefined"){o.expires="session"}return o}function Ct(t){return typeof t==="string"&&!!t.trim()}function xt(t){if(Gt(t)){Rt(t.name);return}var e=At();e[t.name]=t;wx.setStorageSync(wt,JSON.stringify(e))}function Nt(t,e,n){n=+n||30*60;var i=(new Date).getTime()+n*1e3;var a={name:t,value:e,maxAge:n,expires:new Date(i).toUTCString()};xt(a)}function Et(t){var e=At();if(e[t]&&e[t].name){return e[t].value}return""}function Jt(t){var e=At();return e[t]||{}}function Mt(t){var e=At();var n;for(n in t){if(Gt(t[n])){e=Vt(e,t[n])}else{e=Ut(e,t[n])}}for(n in e){if(Gt(e[n])){e=Vt(e,e[n])}}wx.setStorageSync(wt,JSON.stringify(e))}function Rt(t){var e=At();var n={};var i;if(typeof e[t]==="undefined"||!e[t]["name"]){return}for(i in e){if(i!=="name"){n[i]=e[i]}}wx.setStorageSync(wt,JSON.stringify(n))}function At(){var t=JSON.parse(wx.getStorageSync(wt)||"{}");var e;for(e in t){if(Gt(t[e])){t=Vt(t,t[e])}}wx.setStorageSync(wt,JSON.stringify(t));return t}function Gt(t){var e=(new Date).valueOf();var n;var i=t.expires==="session";if(i){return false}n=new Date(t.expires).valueOf();if(n<=e){return true}return false}function Vt(t,e){delete t[e.name];return t}function Ut(t,e){t[e.name]=e;return t}var Dt=Object.freeze({set:xt,get:Jt,getAll:At,del:Rt,multiSet:Mt,setValue:Nt,getValue:Et});function Lt(t){t=t||{};var e=t.module||"wajax";var n="web_js";var i=t.content||{};var a="https://mudu.tv/?c=system&a=ajaxApiWriteLog&content="+encodeURIComponent(JSON.stringify(i))+"&module="+e+"&logStore="+n;wx.request({url:a})}function Ft(t){Bt(t,"GET");Bt(t,"POST");Bt(t,"OPTIONS");Bt(t,"HEAD");Bt(t,"PUT");Bt(t,"DELETE");Bt(t,"TRACE");Bt(t,"CONNECT")}function Bt(t,e){t.prototype[e.toLowerCase()]=function(t){var n=this;var i=t.url;var a=t.data;var r=t.dataType;var o=t.contentType;var s=t.responseType;return new Promise(function(t,p){var c=Pt(At());var u=typeof r==="undefined"?n.option.dataType:r;var f=typeof o==="undefined"?n.option.contentType:o;var d={"content-type":f};d[n.option.cookieHeaderKey]=c;var h=Math.random();n._debug&&console.log("request start "+h,{url:i,data:a,method:e,header:d,dataType:u});wx.request({url:i,data:a,method:e,header:d,dataType:u,responseType:s||"text",success:function(e){t(e);n._debug&&console.log("request success "+h,{res:e});e.header["Set-Cookie"]&&Mt(St(e.header["Set-Cookie"]))},fail:function(t){n._debug&&console.log("request fail "+h,{res:t});p(t)},complete:function(t){n._debug&&Lt({content:{requestRandom:h,header:d,reqDataType:u,url:i,method:e,response:JSON.stringify(t).length>1e3?"response too large to upload":t}})}})})}}function Ht(t){t.prototype.setOption=function(t,e){this.option[t]=e}}function qt(t){t.prototype.getOption=function(t){return this.option[t]}}function Qt(t){t.prototype.createInstance=function(e){return new t(e)}}function Kt(t){this.cookie=Dt;this._initOpt=t&&typeof t==="object"?t:{};this._debug=this._initOpt.debug||false;this.option={dataType:kt,contentType:jt,cookieHeaderKey:this._initOpt.cookieHeaderKey||Tt}}Ft(Kt);Ht(Kt);qt(Kt);Qt(Kt);var Wt=new Kt;"use strict";var $t=function(t){return encodeURIComponent(t).replace(/[!'()*]/g,function(t){return"%"+t.charCodeAt(0).toString(16).toUpperCase()})};"use strict";var Xt=Object.getOwnPropertySymbols;var zt=Object.prototype.hasOwnProperty;var Yt=Object.prototype.propertyIsEnumerable;function Zt(t){if(t===null||t===undefined){throw new TypeError("Object.assign cannot be called with null or undefined")}return Object(t)}function te(){try{if(!Object.assign){return false}var t=new String("abc");t[5]="de";if(Object.getOwnPropertyNames(t)[0]==="5"){return false}var e={};for(var n=0;n<10;n++){e["_"+String.fromCharCode(n)]=n}var i=Object.getOwnPropertyNames(e).map(function(t){return e[t]});if(i.join("")!=="0123456789"){return false}var a={};"abcdefghijklmnopqrst".split("").forEach(function(t){a[t]=t});if(Object.keys(Object.assign({},a)).join("")!=="abcdefghijklmnopqrst"){return false}return true}catch(t){return false}}var ee=te()?Object.assign:function(t,e){var n;var i=Zt(t);var a;for(var r=1;r<arguments.length;r++){n=Object(arguments[r]);for(var o in n){if(zt.call(n,o)){i[o]=n[o]}}if(Xt){a=Xt(n);for(var s=0;s<a.length;s++){if(Yt.call(n,a[s])){i[a[s]]=n[a[s]]}}}}return i};"use strict";var ne="%[a-f0-9]{2}";var ie=new RegExp(ne,"gi");var ae=new RegExp("("+ne+")+","gi");function re(t,e){try{return decodeURIComponent(t.join(""))}catch(t){}if(t.length===1){return t}e=e||1;var n=t.slice(0,e);var i=t.slice(e);return Array.prototype.concat.call([],re(n),re(i))}function oe(t){try{return decodeURIComponent(t)}catch(i){var e=t.match(ie);for(var n=1;n<e.length;n++){t=re(e,n).join("");e=t.match(ie)}return t}}function se(t){var e={"%FE%FF":"��","%FF%FE":"��"};var n=ae.exec(t);while(n){try{e[n[0]]=decodeURIComponent(n[0])}catch(t){var i=oe(n[0]);if(i!==n[0]){e[n[0]]=i}}n=ae.exec(t)}e["%C2"]="�";var a=Object.keys(e);for(var r=0;r<a.length;r++){var o=a[r];t=t.replace(new RegExp(o,"g"),e[o])}return t}var pe=function(t){if(typeof t!=="string"){throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof t+"`")}try{t=t.replace(/\+/g," ");return decodeURIComponent(t)}catch(e){return se(t)}};"use strict";function ce(t){switch(t.arrayFormat){case"index":return function(e,n,i){return n===null?[fe(e,t),"[",i,"]"].join(""):[fe(e,t),"[",fe(i,t),"]=",fe(n,t)].join("")};case"bracket":return function(e,n){return n===null?fe(e,t):[fe(e,t),"[]=",fe(n,t)].join("")};default:return function(e,n){return n===null?fe(e,t):[fe(e,t),"=",fe(n,t)].join("")}}}function ue(t){var e;switch(t.arrayFormat){case"index":return function(t,n,i){e=/\[(\d*)\]$/.exec(t);t=t.replace(/\[\d*\]$/,"");if(!e){i[t]=n;return}if(i[t]===undefined){i[t]={}}i[t][e[1]]=n};case"bracket":return function(t,n,i){e=/(\[\])$/.exec(t);t=t.replace(/\[\]$/,"");if(!e){i[t]=n;return}else if(i[t]===undefined){i[t]=[n];return}i[t]=[].concat(i[t],n)};default:return function(t,e,n){if(n[t]===undefined){n[t]=e;return}n[t]=[].concat(n[t],e)}}}function fe(t,e){if(e.encode){return e.strict?$t(t):encodeURIComponent(t)}return t}function de(t){if(Array.isArray(t)){return t.sort()}else if(typeof t==="object"){return de(Object.keys(t)).sort(function(t,e){return Number(t)-Number(e)}).map(function(e){return t[e]})}return t}var he=function(t){var e=t.indexOf("?");if(e===-1){return""}return t.slice(e+1)};var le=function(t,e){e=ee({arrayFormat:"none"},e);var n=ue(e);var i=Object.create(null);if(typeof t!=="string"){return i}t=t.trim().replace(/^[?#&]/,"");if(!t){return i}t.split("&").forEach(function(t){var e=t.replace(/\+/g," ").split("=");var a=e.shift();var r=e.length>0?e.join("="):undefined;r=r===undefined?null:pe(r);n(pe(a),r,i)});return Object.keys(i).sort().reduce(function(t,e){var n=i[e];if(Boolean(n)&&typeof n==="object"&&!Array.isArray(n)){t[e]=de(n)}else{t[e]=n}return t},Object.create(null))};var ve=function(t,e){var n={encode:true,strict:true,arrayFormat:"none"};e=ee(n,e);var i=ce(e);return t?Object.keys(t).sort().map(function(n){var a=t[n];if(a===undefined){return""}if(a===null){return fe(n,e)}if(Array.isArray(a)){var r=[];a.slice().forEach(function(t){if(t===undefined){return}r.push(i(n,t,r.length))});return r.join("&")}return fe(n,e)+"="+fe(a,e)}).filter(function(t){return t.length>0}).join("&"):""};var me={extract:he,parse:le,stringify:ve};var ge=Wt.createInstance();function _e(t){var e=t.method.toLowerCase();var n={url:t.url,type:e.toUpperCase()};if(e.toLowerCase()==="get"&&t.data){n.url=t.url+"?"+me.stringify(t.data)}if(t.data&&e.toLowerCase()!=="get"){if(ge.getOption("contentType")==="application/x-www-form-urlencoded"){n.data=me.stringify(t.data)}}return ge.post({url:h,data:n})}_e.setOption=ge.setOption.bind(ge);_e.getOption=ge.getOption.bind(ge);function ye(t){t.prototype.transfer=_e}function Oe(t){t.prototype.storage={getUser:we,setUser:be,delUser:ke}}function be(t){console.log("storage.setUser is longer supported.")}function we(){return m()}function ke(){console.log("storage.setUser is longer supported.")}function je(t){t.prototype.Destroy=function(){this.app._eventEmitter.Pub("room-destroy")}}function Te(t){t.prototype.createInstance=function(e){return new t(e)}}function Pe(){return{skip_login:u,login_server_url:f,visitorid_field:d,mudu_baseinfo_url:l}}function Se(t){this._initOpt=t&&typeof t==="object"?t:{};this._debug=this._initOpt.debug||false;this.wajax=Wt.createInstance({debug:this._debug});this.wajax.setOption("cookieHeaderKey","Cookie");this.cookie=this.wajax.cookie;this.options=Pe();this.app=this}_t(Se);yt(Se);Ot(Se);ye(Se);Oe(Se);Te(Se);je(Se);var Ie=new Se;return Ie});